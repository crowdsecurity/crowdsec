name: Hub Tests

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:
  hubtest:
    name: Hub tests
    runs-on: ubuntu-latest
    env:
      PUSH_COVERAGE: ${{ github.ref == 'refs/pull/999/merge' }}
    steps:
    - name: Set up Go 1.16
      uses: actions/setup-go@v1
      with:
        go-version: 1.16
      id: go
    - name: Check out code into the Go module directory
      uses: actions/checkout@v2
    - name: debuuuug
      run: echo ${{ env.PUSH_COVERAGE }}
    - name: debuuuuuuuuug
      run: echo ${{ github.ref }}
    - name: Create Parsers badge
      uses: schneegans/dynamic-badges-action@v1.1.0
      if: ${{ github.ref == 'refs/pull/999/merg' }}
      with:
        auth: ${{ secrets.GIST_BADGES_SECRET }}
        gistID: ${{ secrets.GIST_BADGES_ID }}
        filename: crowdsec_parsers_badge.json
        label: Hub Parsers
        message: ${{ env.PARSERS_COV }}
        color: ${{ env.SCENARIO_BADGE_COLOR }}
    - name: Create Scenarios badge
      uses: schneegans/dynamic-badges-action@v1.1.0
      if: ${{ github.ref == 'refs/pull/999/merg' }}
      with:
        auth: ${{ secrets.GIST_BADGES_SECRET }}
        gistID: ${{ secrets.GIST_BADGES_ID }}
        filename: crowdsec_scenarios_badge.json
        label: Hub Scenarios
        message: ${{ env.SCENARIOS_COV }}
        color: ${{ env.SCENARIO_BADGE_COLOR }}


